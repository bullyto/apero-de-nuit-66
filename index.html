<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0b1220" />
  <title>Calculateur TTC</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="icon" href="icon-512.png" sizes="512x512" type="image/png" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Petit polish marketing (sans dépendances) */
    .bg-neon {
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(56,189,248,.22), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(34,197,94,.20), transparent 55%),
        radial-gradient(900px 600px at 50% 95%, rgba(168,85,247,.14), transparent 55%),
        linear-gradient(180deg, #050914 0%, #0b1220 40%, #0b1220 100%);
    }
    .glass {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
    }
    .ring-neon {
      box-shadow: 0 0 0 1px rgba(56,189,248,.18), 0 0 40px rgba(56,189,248,.12);
    }
    .btn {
      transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
    }
    .btn:active { transform: translateY(1px); }
    @media (prefers-reduced-motion: reduce) { .btn { transition: none; } }

    /* ===== Barre de chargement (sans boutons) ===== */
    .load-wrap{
      width: 100%;
      max-width: 260px;
      margin-top: 8px;
    }
    .load-label{
      display:flex;
      justify-content:flex-end;
      font-size:12px;
      color: rgba(255,255,255,.70);
      line-height: 1;
      margin-bottom: 6px;
      user-select:none;
    }
    .load-track{
      width:100%;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.45);
    }
    .load-bar{
      height:100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(56,189,248,.95), rgba(34,211,238,.95));
      box-shadow: 0 0 18px rgba(56,189,248,.28);
      position: relative;
    }
    .load-bar::after{
      content:"";
      position:absolute;
      inset: 2px 6px auto 6px;
      height: 42%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,255,255,.28), rgba(255,255,255,0));
      opacity:.75;
      pointer-events:none;
    }
    .load-hide{
      opacity:0;
      transform: translateY(-4px);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
    }
  </style>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker enregistré', reg))
          .catch(err => console.error('Erreur SW :', err));
      });
    }
  </script>

  <style>
    /* UI épurée : masquage VISUEL uniquement (logique inchangée) */
    .bg-white\/10.px-3.py-1.text-xs.font-semibold.tracking-wide { display:none !important; }
    .mt-1.text-sm.text-white\/70 { display:none !important; }
    .glass.rounded-2xl.px-4.py-3.text-sm { display:none !important; }
    .mt-4.text-xs.text-white\/55 { display:none !important; }
    footer.mt-8 { display:none !important; }
  </style>

  <style>
    /* UI épurée : supprimer l'espace des cartes masquées (stockage/astuce) */
    header .flex.flex-col.sm\:flex-row.gap-2.sm\:items-center { display:none !important; }
  </style>

</head>

<body class="min-h-screen bg-neon text-white">
  <div class="max-w-6xl mx-auto px-4 py-6">
    <!-- Header -->
    <header class="glass ring-neon rounded-3xl px-5 py-5 md:px-7 md:py-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex items-center gap-4">
          <div class="shrink-0">
            <img
              src="https://static.wixstatic.com/media/bc6106_2760d0ad9fe847418ba1d73666102706~mv2.png/v1/fill/w_560,h_320,al_c,lg_1,q_85,enc_avif,quality_auto/apero%20de%20nuit%20n.png"
              alt="Apéro de Nuit 66"
              class="h-14 w-auto drop-shadow"
              onerror="this.onerror=null;this.src='icon-192.png';"
            />
          </div>

          <div>
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-xs font-semibold tracking-wide">
                Apéro de Nuit 66 • PWA
              </span>
              <span class="hidden sm:inline-flex items-center rounded-full bg-emerald-400/15 px-3 py-1 text-xs font-semibold tracking-wide text-emerald-200">
                Calcul TTC + taxes
              </span>
            </div>

            <h1 class="mt-2 text-xl md:text-2xl font-extrabold leading-tight">
              Calculateur TTC
            </h1>

            <p class="mt-1 text-sm text-white/70">
              Ajoute tes produits, vérifie TVA + CSS, et garde tout enregistré <span class="font-semibold text-white/80">en local</span> jusqu’à effacement.
            </p>

            <!-- ✅ Barre de chargement sous l'icône (démarrage) -->
            <div id="loadWrap" class="load-wrap" aria-label="Chargement">
              <div class="load-label"><span id="loadPct">0%</span></div>
              <div class="load-track">
                <div id="loadBar" class="load-bar"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
          <div class="glass rounded-2xl px-4 py-3 text-sm">
            <div class="text-white/60">Stockage</div>
            <div class="font-semibold">LocalStorage (persistant)</div>
          </div>
          <div class="glass rounded-2xl px-4 py-3 text-sm">
            <div class="text-white/60">Astuce</div>
            <div class="font-semibold">“Effacer tout” remet à zéro</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- Form card -->
      <section class="lg:col-span-5 glass ring-neon rounded-3xl p-5 md:p-6">
        <div class="mt-3 flex gap-2">
          <button id="modeAlcohol" type="button"
            class="px-4 py-2 rounded-2xl bg-white/15 hover:bg-white/20 border border-white/15 text-sm font-semibold">
            Alcool
          </button>
          <button id="modeSoda" type="button"
            class="px-4 py-2 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 text-sm font-semibold text-white/80">
            Soda
          </button>
        </div>

        <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="sm:col-span-2">
            <label for="name" class="block text-xs font-semibold text-white/70">Nom du produit</label>
            <input id="name" type="text"
              class="mt-1 w-full rounded-2xl bg-white/10 border border-white/10 px-4 py-3 text-white placeholder-white/40 out
